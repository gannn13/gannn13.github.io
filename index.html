<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulus Diferensial • Analisis Charger HP – Kelompok 2</title>
    <meta name="description" content="Proyek Akhir Mata Kuliah Kalkulus Diferensial – Analisis Efisiensi Charger menggunakan Turunan Numerik dSoC/dt">

    <!-- Chart.js & MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --bg: #0b1120;
            --card: rgba(15, 25, 50, 0.7);
            --primary: #2563eb;
            --accent: #60a5fa;
            --glow: #3b82f6;
            --text: #f1f5f9;
            --muted: #94a3b8;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0b1120 0%, #1e293b 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px 10px;
            background-image: radial-gradient(circle at 10% 20%, rgba(37,99,235,0.2) 0%, transparent 90%, transparent 90%);
        }
        .container { max-width: 1300px; margin: 0 auto; }

        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            border-radius: 24px;
            margin-bottom: 30px;
            box-shadow: 0 20px 50px rgba(37,99,235,0.4);
            position: relative;
            overflow: hidden;
        }
        header::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(96,165,250,0.3), transparent);
            animation: rotate 20s linear infinite;
        }
        @keyframes rotate { to { transform: rotate(360deg); } }

        .title {
            font-size: 2.4em;
            font-weight: 800;
            color: white;
            text-shadow: 0 0 20px rgba(96,165,250,0.8);
            margin: 10px 0;
        }
        .subtitle { font-size: 1.2em; opacity: 0.9; color: #ddd; }

        .badge {
            display: inline-block;
            background: #dc2626;
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: bold;
            margin-top: 15px;
            box-shadow: 0 0 20px rgba(220,38,38,0.5);
        }

        .card {
            background: var(--card);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(96,165,250,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: all 0.4s;
        }
        .card:hover { transform: translateY(-10px); box-shadow: 0 20px 50px rgba(59,130,246,0.3); }

        h2 {
            color: var(--accent);
            font-size: 1.7em;
            margin-bottom: 20px;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 10px;
            display: inline-block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(15,23,42,0.6);
            border-radius: 16px;
            overflow: hidden;
            margin: 20px 0;
        }
        th {
            background: var(--primary);
            color: white;
            padding: 16px;
            font-weight: 600;
        }
        td { padding: 14px; text-align: center; border-bottom: 1px solid #334155; }
        input {
            width: 100%;
            padding: 12px;
            background: #1e293b;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1em;
        }
        input:focus { outline: 2px solid var(--accent); }

        button {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .btn {
            background: var(--primary);
            color: white;
        }
        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(37,99,235,0.4);
        }
        .btn-danger { background: #dc2626; }
        .btn-success { background: #16a34a; width: 100%; font-size: 1.1em; padding: 18px; }

        .formula-box {
            background: linear-gradient(135deg, rgba(37,99,235,0.15), rgba(96,165,250,0.1));
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--accent);
            margin: 25px 0;
            box-shadow: 0 0 30px rgba(96,165,250,0.2);
        }
        .math {
            background: rgba(15,23,42,0.9);
            padding: 20px;
            border-radius: 14px;
            margin: 18px 0;
            font-size: 1.25em;
            text-align: center;
            border-left: 6px solid var(--accent);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        canvas {
            border-radius: 16px;
            background: var(--card);
            padding: 15px;
            margin: 15px 0;
        }

        .footer {
            text-align: center;
            padding: 40px;
            color: var(--muted);
            font-size: 1em;
            margin-top: 50px;
            border-top: 1px solid #334155;
        }
        .footer strong { color: var(--accent); }

        .floating {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            font-size: 28px;
            box-shadow: 0 0 30px rgba(37,99,235,0.7);
            animation: pulse 2s infinite;
            z-index: 999;
            border: none;
            cursor: pointer;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(37,99,235,0.7); }
            70% { box-shadow: 0 0 0 20px rgba(37,99,235,0); }
            100% { box-shadow: 0 0 0 0 rgba(37,99,235,0); }
        }

        @media (max-width: 768px) {
            .title { font-size: 1.8em; }
            .card { padding: 20px; }
            button { width: 100%; margin: 8px 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="title">Analisis Efisiensi Charger HP</h1>
            <p class="subtitle">Menggunakan Turunan Numerik dSoC/dt (%/menit)</p>
            <div class="badge">PROYEK AKHIR<br>MATA KULIAH KALKULUS DIFERENSIAL</div>
            <p style="margin-top:20px; font-size:1.1em; opacity:0.9;">
                <strong>Kelompok 2</strong> • Semester Genap 2024/2025
            </p>
        </header>

        <div class="card">
            <h2>Input Data Percobaan</h2>
            <table id="dataTable">
                <thead><tr><th>Waktu (menit)</th><th>SoC (%)</th><th>Aksi</th></tr></thead>
                <tbody>
                    <tr>
                        <td><input type="number" step="0.1" min="0" value="0" required></td>
                        <td><input type="number" min="0" max="100" value="8" required></td>
                        <td><button class="btn btn-danger">Hapus</button></td>
                    </tr>
                </tbody>
            </table>
            <button class="btn" id="addRow">+ Tambah Baris</button>
            <button class="btn" id="resetTable">Reset Tabel</button>
            <button class="btn" id="pasteCSV">Tempel dari CSV</button>
        </div>

        <div class="card">
            <h2>Teori Turunan Numerik (Beda Hingga)</h2>
            <div class="formula-box">
                <p>Turunan pertama secara analitik didefinisikan sebagai:</p>
                <div class="math">
                    \[\frac{dSoC}{dt} = \lim_{\Delta t \to 0} \frac{SoC(t + \Delta t) - SoC(t)}{\Delta t}\]
                </div>

                <p>Karena data diskrit → digunakan <strong>aproksimasi beda hingga</strong>:</p>

                <div class="math">
                    \[\left( \frac{dSoC}{dt} \right)_0 \approx \frac{SoC_1 - SoC_0}{t_1 - t_0} \quad \text{(Forward Difference)}\]</div>

                <div class="math">
                    \[\left( \frac{dSoC}{dt} \right)_n \approx \frac{SoC_n - SoC_{n-1}}{t_n - t_{n-1}} \quad \text{(Backward Difference)}\]</div>

                <div class="math">
                    \[\left( \frac{dSoC}{dt} \right)_i \approx \frac{SoC_{i+1} - SoC_{i-1}}{t_{i+1} - t_{i-1}} \quad \text{(Central Difference)}\]</div>

                <p><strong>Skor Efisiensi</strong> (0–100):</p>
                <div class="math">
                    \[\text{Skor} = \min\left(100,\ 10 \times \overline{\left|\frac{dSoC}{dt}\right|}\right)\]
                </div>
                <small>∗ 10 %/menit dianggap sebagai charger super cepat (120 W+)</small>
            </div>

            <h3>Langkah Perhitungan Detail</h3>
            <div id="stepByStep" style="background:rgba(15,23,42,0.8); padding:20px; border-radius:14px; line-height:2;"></div>
        </div>

        <div class="card">
            <h2>Hasil Perhitungan</h2>
            <div id="calculationResults" style="text-align:center; font-size:2em; padding:30px; background:linear-gradient(135deg,#166534,#16a34a); border-radius:16px; color:white;"></div>
        </div>

        <div class="card">
            <h2>Grafik Interaktif</h2>
            <canvas id="socChart"></canvas>
            <canvas id="dsocdtChart"></canvas>
        </div>

        <div class="card">
            <h2>Upload ke Leaderboard Publik</h2>
            <input type="text" id="merkCharger" placeholder="Contoh: Samsung 45W PD Charger" style="margin:10px 0; padding:14px;">
            <input type="text" id="hpModel" placeholder="Contoh: Samsung Galaxy S24 Ultra">
            <button class="btn btn-success" id="uploadPublic">Upload Hasil ke Leaderboard</button>
        </div>

        <div class="card">
            <h2>Leaderboard Publik (localStorage)</h2>
            <div id="publicFeed"></div>
        </div>

        <div class="card">
            <h2>Ekspor Data & Laporan</h2>
            <button class="btn" id="exportCSV" style="width:48%;">Download CSV</button>
            <button class="btn" id="exportHTML" style="width:48%;">Download Laporan HTML</button>
        </div>
    </div>

    <button class="floating" id="scrollTop" title="Ke atas">Up Arrow</button>

    <!-- Modal CSV -->
    <div id="csvModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:9999;display:flex;align-items:center;justify-content:center;">
        <div style="background:#1e293b;padding:30px;border-radius:20px;width:90%;max-width:600px;">
            <h2 style="color:white;margin-bottom:20px;">Tempel Data CSV</h2>
            <textarea id="csvInput" style="width:100%;height:250px;background:#0f172a;color:white;padding:15px;border-radius:12px;font-family:monospace;"></textarea>
            <button class="btn" id="submitCSV" style="width:100%;margin-top:15px;padding:15px;">Submit CSV</button>
            <button style="position:absolute;top:10px;right:20px;font-size:30px;background:none;border:none;color:white;cursor:pointer;" id="closeModal">×</button>
        </div>
    </div>

    <div class="footer">
        <p>© 2025 <strong>Kelompok 2</strong> • Mata Kuliah Kalkulus Diferensial</p>
        <p>Dibuat dengan JavaScript, Chart.js, MathJax • Hosted Gratis di <strong>GitHub Pages</strong></p>
    </div>

    <script>
        // === Semua JavaScript ===
        const tbody = document.querySelector('#dataTable tbody');
        const addRow = document.getElementById('addRow');
        const reset = document.getElementById('resetTable');
        const paste = document.getElementById('pasteCSV');
        const modal = document.getElementById('csvModal');
        const closeModal = document.getElementById('closeModal');
        const submitCSV = document.getElementById('submitCSV');
        const csvInput = document.getElementById('csvInput');
        const stepByStep = document.getElementById('stepByStep');
        const results = document.getElementById('calculationResults');
        const uploadBtn = document.getElementById('uploadPublic');
        const merk = document.getElementById('merkCharger');
        const hp = document.getElementById('hpModel');
        const feed = document.getElementById('publicFeed');

        let chartSoc, chartRate;

        // Tambah baris
        addRow.onclick = () => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td><input type="number" step="0.1" min="0"></td>
                            <td><input type="number" min="0" max="100"></td>
                            <td><button class="btn btn-danger">Hapus</button></td>`;
            tbody.appendChild(tr);
            tr.querySelector('.btn-danger').onclick = () => { tr.remove(); calc(); };
        };

        // Hapus baris
        document.querySelectorAll('.btn-danger').forEach(btn => {
            btn.onclick = () => { btn.closest('tr').remove(); calc(); };
        });

        reset.onclick = () => location.reload();
        paste.onclick = () => modal.style.display = 'flex';
        closeModal.onclick = () => modal.style.display = 'none';
        submitCSV.onclick = () => {
            tbody.innerHTML = '';
            csvInput.value.trim().split('\n').forEach(line => {
                const [t, soc] = line.split(',').map(x => parseFloat(x));
                if (!isNaN(t) && !isNaN(soc)) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td><input type="number" step="0.1" value="${t}"></td>
                                    <td><input type="number" value="${soc}"></td>
                                    <td><button class="btn btn-danger">Hapus</button></td>`;
                    tbody.appendChild(tr);
                    tr.querySelector('.btn-danger').onclick = () => { tr.remove(); calc(); };
                }
            });
            modal.style.display = 'none';
            calc();
        };

        function getData() {
            const data = [];
            tbody.querySelectorAll('tr').forEach(row => {
                const inputs = row.querySelectorAll('input');
                const t = parseFloat(inputs[0].value);
                const soc = parseFloat(inputs[1].value);
                if (!isNaN(t) && !isNaN(soc)) data.push({t, soc});
            });
            return data.sort((a,b) => a.t - b.t);
        }

        function calc() {
            const data = getData();
            if (data.length < 2) {
                results.innerHTML = 'Masukkan minimal 2 titik data!';
                stepByStep.innerHTML = '';
                return;
            }

            const rates = [];
            const steps = [];

            for (let i = 0; i < data.length; i++) {
                let rate, formula;
                if (i === 0) {
                    rate = (data[1].soc - data[0].soc) / (data[1].t - data[0].t);
                    formula = `\\text{Forward} \\quad \\dfrac{${data[1].soc} - ${data[0].soc}}{${data[1].t} - ${data[0].t}} = ${rate.toFixed(4)}`;
                } else if (i === data.length - 1) {
                    rate = (data[i].soc - data[i-1].soc) / (data[i].t - data[i-1].t);
                    formula = `\\text{Backward} \\quad \\dfrac{${data[i].soc} - ${data[i-1].soc}}{${data[i].t} - ${data[i-1].t}} = ${rate.toFixed(4)}`;
                } else {
                    rate = (data[i+1].soc - data[i-1].soc) / (data[i+1].t - data[i-1].t);
                    formula = `\\text{Central} \\quad \\dfrac{${data[i+1].soc} - ${data[i-1].soc}}{${data[i+1].t} - ${data[i-1].t}} = ${rate.toFixed(4)}`;
                }
                rates.push(rate);
                steps.push(formula);
            }

            const avgRate = rates.reduce((a,b)=>a+b,0)/rates.length;
            const skor = Math.min(100, avgRate * 10).toFixed(1);

            results.innerHTML = `
                <div style="font-size:2.5em; margin:10px 0;">${avgRate.toFixed(3)} %/menit</div>
                <div style="font-size:1.4em;">Skor Efisiensi: <strong style="color:#60a5fa;">${skor}/100</strong></div>
            `;

            stepByStep.innerHTML = '<ol start="1" style="font-size:1.1em;">' + 
                steps.map(s => `<li>${s}</li>`).join('') + '</ol>';
            MathJax.typesetPromise();

            // Grafik
            const labels = data.map(d => d.t);
            if (chartSoc) chartSoc.destroy();
            if (chartRate) chartRate.destroy();

            chartSoc = new Chart(document.getElementById('socChart'), {
                type: 'line',
                data: { labels, datasets: [{ label: 'SoC (%)', data: data.map(d=>d.soc), borderColor: '#60a5fa', backgroundColor: 'rgba(96,165,250,0.2)', tension: 0.4, fill: true }] },
                options: { responsive: true, plugins: { title: { display: true, text: 'State of Charge vs Waktu', color: 'white' } }, scales: { x: { title: { display: true, text: 'Waktu (menit)' } } } }
            });

            chartRate = new Chart(document.getElementById('dsocdtChart'), {
                type: 'line',
                data: { labels, datasets: [{ label: 'dSoC/dt (%/menit)', data: rates, borderColor: '#f59e0b', backgroundColor: 'rgba(245,158,11,0.3)', tension: 0.4, fill: true }] },
                options: { responsive: true, plugins: { title: { display: true, text: 'Laju Pengisian vs Waktu', color: 'white' } } }
            });
        }

        // Ekspor
        document.getElementById('exportCSV').onclick = () => {
            let csv = "Waktu (menit),SoC (%)\n" + getData().map(d => `${d.t},${d.soc}`).join("\n");
            download(csv, "data_charger_kelompok2.csv", "text/csv");
        };
        document.getElementById('exportHTML').onclick = () => {
            const data = getData();
            const avg = (rates.reduce((a,b)=>a+b,0)/rates.length || 0).toFixed(3);
            const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>Laporan Kelompok 2</title><style>body{font-family:sans-serif;padding:40px;background:#0b1120;color:white;}</style></head><body>
                <h1>Laporan Analisis Charger – Kelompok 2</h1>
                <p>Rata-rata dSoC/dt: ${avg} %/menit | Skor: ${skor}/100</p>
                <table border="1" style="width:100%;border-collapse:collapse;"><tr><th>Waktu</th><th>SoC</th></tr>${data.map(d=>`<tr><td>${d.t}</td><td>${d.soc}</td></tr>`).join('')}</table>
                <p>Generated: ${new Date().toLocaleString('id-ID')}</p></body></html>`;
            download(html, "laporan_kelompok2.html", "text/html");
        };
        function download(text, filename, type) {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([text], {type}));
            a.download = filename;
            a.click();
        }

        // Leaderboard
        uploadBtn.onclick = () => {
            calc();
            if (!merk.value || !hp.value) return alert("Isi merk charger & model HP!");
            const entry = { merk: merk.value, hp: hp.value, avg: avgRate.toFixed(3), skor, skor, time: new Date().toLocaleString('id-ID') };
            let list = JSON.parse(localStorage.getItem('kelompok2_leaderboard')||'[]');
            list.unshift(entry);
            localStorage.setItem('kelompok2_leaderboard', JSON.stringify(list));
            loadLeaderboard();
            alert("Berhasil diupload ke leaderboard!");
        };
        function loadLeaderboard() {
            const list = JSON.parse(localStorage.getItem('kelompok2_leaderboard')||'[]');
            feed.innerHTML = list.length ? `
                <table style="width:100%;text-align:left;">
                    <tr style="background:#2563eb;color:white;"><th>Charger</th><th>HP</th><th>dSoC/dt</th><th>Skor</th><th>Waktu</th></tr>
                    ${list.map(e=>`<tr><td>${e.merk}</td><td>${e.hp}</td><td>${e.avg}</td><td><strong>${e.skor}</strong></td><td>${e.time}</td></tr>`).join('')}
                </table>` : '<p style="text-align:center;color:#94a3b8;">Belum ada data</p>';
        }
        loadLeaderboard();

        document.getElementById('scrollTop').onclick = () => window.scrollTo({top:0, behavior:'smooth'});

        tbody.addEventListener('input', calc);
        calc();
    </script>
</body>
</html>
