<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Analisis Efisiensi Charger HP — dSoC/dt</title>

  <!-- Tailwind (opsional, CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- PapaParse CDN -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- Styles lokal -->
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="max-w-6xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-2xl font-bold">Analisis Efisiensi Charger HP</h1>
      <p class="text-sm text-gray-600">Dashboard Efisiensi Charger HP — Analisis dSoC/dt</p>
    </header>

    <!-- UPLOADER -->
    <section id="uploader" class="mb-6 bg-white p-4 shadow rounded">
      <h2 class="font-semibold">Unggah CSV</h2>
      <p class="text-sm text-gray-600">Format CSV wajib: <code>charger,time_min,soc_percent,hp_brand,charger_type,charger_price,uploader</code></p>

      <div class="mt-3">
        <input id="csvFile" type="file" accept=".csv" />
        <button id="btnPreview" class="ml-3 px-3 py-1 bg-blue-600 text-white rounded">Tampilkan Preview</button>
      </div>

      <div id="previewArea" class="mt-4 hidden">
        <h3 class="font-medium">Preview (10 baris pertama)</h3>
        <pre id="previewText" class="bg-gray-100 p-2 rounded text-sm overflow-auto max-h-40"></pre>

        <div id="uploaderNameWrap" class="mt-2 hidden">
          <label class="block text-sm">Masukkan nama Anda (kolom uploader tidak ada):</label>
          <input id="uploaderName" type="text" class="border p-1 rounded" />
        </div>

        <div class="mt-3">
          <label class="inline-flex items-center"><input type="checkbox" id="toggleSmoothing" class="mr-2"> Gunakan smoothing (moving average window=3)</label>
        </div>

        <div class="mt-3">
          <button id="btnUpload" class="px-3 py-1 bg-green-600 text-white rounded">Unggah CSV (simpan lokal)</button>
          <span id="uploadStatus" class="ml-3 text-sm text-gray-600"></span>
        </div>
      </div>
    </section>

    <!-- FILTER -->
    <section id="filterSection" class="mb-6 bg-white p-4 shadow rounded">
      <h2 class="font-semibold">Filter & Kontrol</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
        <div>
          <label class="block text-sm">Merek HP (hp_brand)</label>
          <select id="filterBrand" class="w-full border p-1 rounded"><option value="">(Semua)</option></select>
        </div>
        <div>
          <label class="block text-sm">Tipe Charger (charger_type)</label>
          <select id="filterChgType" class="w-full border p-1 rounded"><option value="">(Semua)</option></select>
        </div>
        <div>
          <label class="block text-sm">Rentang Harga (Rp)</label>
          <input id="filterPriceMin" type="number" placeholder="Min" class="w-1/2 border p-1 rounded" />
          <input id="filterPriceMax" type="number" placeholder="Max" class="w-1/2 border p-1 rounded" />
        </div>
        <div>
          <label class="block text-sm">Uploader</label>
          <select id="filterUploader" class="w-full border p-1 rounded"><option value="">(Semua)</option></select>
        </div>
      </div>

      <div class="mt-3">
        <label class="block text-sm">Tampilkan grup</label>
        <select id="selectGroup" class="w-full border p-1 rounded"><option value="all">Tampilkan semua</option></select>
      </div>
    </section>

    <!-- CHARTS -->
    <section id="charts" class="mb-6 grid grid-cols-1 lg:grid-cols-2 gap-4">
      <div class="bg-white p-4 shadow rounded">
        <h3 class="font-medium">SoC(t)</h3>
        <canvas id="chartSoC"></canvas>
      </div>
      <div class="bg-white p-4 shadow rounded">
        <h3 class="font-medium">dSoC/dt ( %/menit )</h3>
        <canvas id="chartD"></canvas>
      </div>
    </section>

    <!-- SUMMARY TABLE -->
    <section id="tableSection" class="bg-white p-4 shadow rounded">
      <h3 class="font-medium">Ringkasan Grup</h3>
      <div class="overflow-auto mt-3">
        <table id="summaryTable" class="min-w-full text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="p-2">Nama Charger</th>
              <th class="p-2">Merek HP</th>
              <th class="p-2">Tipe Charger</th>
              <th class="p-2">Harga (Rp)</th>
              <th class="p-2">Uploader</th>
              <th class="p-2">Tanggal</th>
              <th class="p-2">Rata-rata (%/menit)</th>
              <th class="p-2">Estimasi 20→80 (menit)</th>
              <th class="p-2">Aksi</th>
            </tr>
          </thead>
          <tbody id="summaryBody"></tbody>
        </table>
      </div>
    </section>

    <footer class="mt-6 text-xs text-gray-600">
      Data bersifat publik. Jika ingin menghapus unggahan, hubungi admin.
    </footer>
  </div>
  <!-- Script lokal -->
  <script src="assets/js/app.js" defer></script>
</body>
</html>
